TRUNCATE TABLE MMAPST.ST_DEP_TRANS_FLOW;
INSERT INTO MMAPST.ST_DEP_TRANS_FLOW(
ETL_DATE,
TX_DATE,
PERIOD_ID,
TRANS_DT,
TRANS_TM,
SER_NO,
ISER_NO,
OPER_ORG,
CUSTOMER_ID,
ACCOUNT_ID,
ACCTTYP_ID,
BUSSTYP_ID,
TRANSCDE_ID,
TREATMENT_CODE,
TRANSDIR_FG,
TRANSST_ID,
TRANSBR_ID,
CHN_ID,
PRODCDE_ID,
TRANS_AMT1,
AFTRANS_AMT1,
TRANSCURR_ID,
TRANS_AMT,
FEECURR_ID,
TRANS_FEE,
OACCTCURR_ID,
REMARK,
PURPDESC,
IMGIDX_NO,
IMGTYP_ID,
EFFECT_DT,
EFFECT_TM,
CHCK_NO,
TRANSACCTTYP_ID,
TRANSACCTCURR_ID,
TRANS_BAL,
TRANSACCT_ORG,
CARD_ORG,
SCNTRY_ID,
SENTITY_ID,
MERC_ID,
REVCARD_NM,
MERCTYP_ID,
MERC_NM,
SOURCEGRP
) 

SELECT 
TO_NUMBER(TO_CHAR(SYSDATE,'YYYYMMDD')) AS ETL_DATE,
A.TX_DT,
TO_NUMBER(TO_CHAR(A.TX_DT,'YYYYMMDD')) AS PERIOD_ID,
TRANS_DT,
TRANS_TM,
TRIM(SER_NO),
ISER_NO,
TRIM(OPER_ORG),
TRIM(A.CIF_ORG),
TRIM(ACCT_ORG),
TRIM(ACCTTYP_ID),
TRIM(BUSSTYP_ID),
TRIM(TRANSCDE_ID),
NULL AS TREATMENT_CODE,
TRIM(TRANSDIR_FG),
TRIM(TRANSST_ID),
TRIM(TRANSBR_ID),
TRIM(CHN_ID),
TRIM(PRODCDE_ID),
TRANS_AMT1,
AFTRANS_AMT1,
TRIM(TRANSCURR_ID),
TRANS_AMT,
TRIM(FEECURR_ID),
TRANS_FEE,
TRIM(OACCTCURR_ID),
A.REMARK,
PURPDESC,
TRIM(IMGIDX_NO),
TRIM(IMGTYP_ID),
EFFECT_DT,
EFFECT_TM,
TRIM(CHCK_NO),
TRIM(TRANSACCTTYP_ID),
TRIM(TRANSACCTCURR_ID),
TRANS_BAL,
TRIM(TRANSACCT_ORG),
TRIM(CARD_ORG),
TRIM(SCNTRY_ID),
TRIM(SENTITY_ID),
TRIM(MERC_ID),
TRIM(REVCARD_NM),
TRIM(MERCTYP_ID),
TRIM(MERC_NM),
NULL AS SOURCEGRP
FROM MMAPST.DMMKT_EVDEPSTTRANS A
INNER JOIN MMAPST.DMMKT_CSMAST B --过滤"个人"客户
ON A.CIF_ORG=B.CIF_ORG
AND TRIM(B.CIFTYP_ID)='I'
INNER JOIN MMAPST.DMMKT_SYSTEM_DATE C --仅取"今日"数据
ON A.TX_DT=TO_DATE(C.TX_DATE,'YYYYMMDD');
